# Example configuration for using external PostgreSQL and S3/MinIO
# This is useful for production environments where you want to use managed services
# This example shows using existing Kubernetes secrets for enhanced security

# Backend configuration with existing JWT secret
backend:
  corsOrigin: "https://dashwright.yourdomain.com"
  jwtExistingSecret: "dashwright-jwt-secrets"  # kubectl create secret generic dashwright-jwt-secrets --from-literal=jwt-secret='...' --from-literal=jwt-refresh-secret='...'

# Disable internal PostgreSQL and use external database with existing secret
postgresql:
  enabled: false
  auth:
    existingSecret: "dashwright-postgresql-password"  # kubectl create secret generic dashwright-postgresql-password --from-literal=password='...'
  external:
    host: "your-postgres-host.example.com"
    port: 5432
    username: "dashwright"
    password: ""  # Not used when existingSecret is set
    database: "dashwright"

# Disable internal MinIO and use external S3-compatible storage with existing secret
minio:
  enabled: false
  external:
    endpoint: "s3.amazonaws.com" # or your MinIO endpoint
    port: 443
    useSSL: true
    accessKey: ""  # Not used when existingSecret is set
    secretKey: ""  # Not used when existingSecret is set
    bucket: "dashwright-artifacts"

# Storage configuration with existing secret
storage:
  endpoint: "https://s3.amazonaws.com"
  region: "us-east-1"
  bucket: "dashwright-artifacts"
  existingSecret: "dashwright-s3-credentials"  # kubectl create secret generic dashwright-s3-credentials --from-literal=access-key='...' --from-literal=secret-key='...'
  accessKey: ""  # Not used when existingSecret is set
  secretKey: ""  # Not used when existingSecret is set

# Enable ingress for external access
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: dashwright.yourdomain.com
      paths:
        - path: /
          pathType: Prefix
          service: frontend
        - path: /api
          pathType: Prefix
          service: backend
  tls:
    - secretName: dashwright-tls
      hosts:
        - dashwright.yourdomain.com

# Frontend configuration
frontend:
  apiUrl: "https://dashwright.yourdomain.com"
  wsUrl: "wss://dashwright.yourdomain.com"

# Update environment variables to match your domain
env:
  backend:
    NODE_ENV: production
    # JWT_SECRET and JWT_REFRESH_SECRET are not defined here because we use jwtExistingSecret above
  frontend:
    VITE_API_URL: "https://dashwright.yourdomain.com/api"
    VITE_WS_URL: "wss://dashwright.yourdomain.com"

# Resource configuration for production
resources:
  backend:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  frontend:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi

# Enable autoscaling
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
